<!DOCTYPE html>  
<html lang="en">  
<head>  
  <meta charset="UTF-8" />  
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>  
  <title>Martoo AI Assistant</title>  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"/>  
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>  
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>  
  <style>  
    /* existing styles preserved... */  
    #login-popup {  
      display: none;  
      position: fixed;  
      top: 0; left: 0;  
      width: 100%; height: 100%;  
      background: rgba(0,0,0,0.85);  
      z-index: 1001;  
      justify-content: center;  
      align-items: center;  
    }  
    #login-popup.show {  
      display: flex;  
    }  
    .login-box {  
      background: #111;  
      padding: 30px;  
      border-radius: 10px;  
      box-shadow: 0 0 15px #00ffcc;  
      color: white;  
      width: 300px;  
      text-align: center;  
    }  
    .login-box input {  
      display: block;  
      margin: 10px auto;  
      padding: 10px;  
      width: 90%;  
      border: none;  
      border-radius: 5px;  
    }  
    .login-box button {  
      margin-top: 10px;  
      width: 100%;  
    }  
  </style>  
</head>  
<body>  
  <header>  
    <h1>Martoo AI Assistant</h1>  
    <div class="hamburger" onclick="toggleMenu()">‚ò∞</div>  
    <nav>  
      <ul id="menu">  
        <li><a href="index.html">Home</a></li>  
        <li><a href="posts.html">Blog</a></li>  
        <li><a href="services.html">Services</a></li>  
        <li><a href="typing_assistant.html">Typing Assistant</a></li>  
        <li><a href="about.html">About</a></li>  
        <li><a href="contact.html">Contact</a></li>  
        <li><a href="downloader.html">Downloader</a></li>  
      </ul>  
    </nav>  
  </header>  
  
  <div class="chat-container">  
    <div class="chat-box" id="chat-box"></div>  
    <div class="chat-input">  
      <input type="text" id="user-input" placeholder="Ask Martoo AI anything..." autocomplete="off"/>  
      <input type="file" id="file-input" accept="image/*" />  
      <button onclick="sendMessage()">Send</button>  
      <button onclick="startDictation()"><i class="fas fa-microphone"></i></button>  
    </div>  
    <img id="preview-img" />  
  </div>  
  
  <div id="login-popup">  
    <div class="login-box">  
      <h3>Login to continue</h3>  
      <input type="email" id="login-email" placeholder="Email" />  
      <input type="password" id="login-password" placeholder="Password" />  
      <button onclick="loginUser()">Login</button>  
      <button onclick="googleSignIn()" style="background:#db4437;"><i class="fab fa-google"></i> Login with Google</button>  
    </div>  
  </div>  
  
  <footer>&copy; 2024‚Äì2025 | Martoo Tech Works. All rights reserved.</footer>  
  
  <script>  
    const firebaseConfig = {  
      apiKey: "AIzaSyCeAWDcPLubp8a8D6uqUwwXeMR6ZlRN3Hc",  
      authDomain: "martoo-ai-assistant.firebaseapp.com",  
      projectId: "martoo-ai-assistant",  
      storageBucket: "martoo-ai-assistant.firebasestorage.app",  
      messagingSenderId: "833564475751",  
      appId: "1:833564475751:web:6b9318c39264f4f78f2fc2"  
    };  
    firebase.initializeApp(firebaseConfig);  
    const auth = firebase.auth();  
  
    let chatCount = 0;  
    let loggedIn = false;  
    const chatBox = document.getElementById("chat-box");  
  
    function toggleMenu() {  
      document.getElementById("menu").classList.toggle("show");  
    }  
  
    window.onload = () => {  
      const saved = localStorage.getItem("martooChat");  
      if (saved) chatBox.innerHTML = saved;  
      else chatBox.innerHTML = `<p><span class="ai">Martoo AI:</span> Hello üëã I‚Äôm here to help. Ask me anything!</p>`;  
  
      auth.onAuthStateChanged(user => {  
        if (user) {  
          loggedIn = true;  
          chatCount = 0;  
        }  
      });  
    };  
  
    document.querySelectorAll("nav ul li a").forEach(link => {  
      link.addEventListener("click", () => document.getElementById("menu").classList.remove("show"));  
    });  
  
    document.getElementById("user-input").addEventListener("keydown", e => {  
      if (e.key === "Enter") sendMessage();  
    });  
  
    document.getElementById("file-input").addEventListener("change", e => {  
      const file = e.target.files[0];  
      if (file) {  
        const reader = new FileReader();  
        reader.onload = e => document.getElementById("preview-img").src = e.target.result;  
        reader.readAsDataURL(file);  
      }  
    });  
  
    async function sendMessage() {  
      if (!loggedIn && chatCount >= 5) {  
        document.getElementById("login-popup").classList.add("show");  
        return;  
      }  
  
      const input = document.getElementById("user-input");  
      const message = input.value.trim();  
      if (!message) return;  
  
      chatCount++;  
  
      const userMessage = document.createElement("p");  
      userMessage.innerHTML = `<span class="user">You:</span> ${message}`;  
      chatBox.appendChild(userMessage);  
  
      const loading = document.createElement("p");  
      loading.innerHTML = `<span class="ai">Martoo AI:</span> <em>Typing...</em>`;  
      chatBox.appendChild(loading);  
      chatBox.scrollTop = chatBox.scrollHeight;  
  
      try {  
        const res = await fetch("https://martoo-tech-backend.vercel.app/api/chat", {  
          method: "POST",  
          headers: { "Content-Type": "application/json" },  
          body: JSON.stringify({ message })  
        });  
        const data = await res.json();  
        loading.innerHTML = `<span class="ai">Martoo AI:</span> ***${data.reply || "‚ö†Ô∏è No response."}***`;  
        input.value = "";  
      } catch (err) {  
        console.error(err);  
        loading.innerHTML = `<span class="ai">Martoo AI:</span> ‚ö†Ô∏è Error connecting to server.`;  
      }  
  
      chatBox.scrollTop = chatBox.scrollHeight;  
      localStorage.setItem("martooChat", chatBox.innerHTML);  
    }  
  
    function startDictation() {  
      if (!('webkitSpeechRecognition' in window)) return alert("Speech recognition not supported.");  
      const recognition = new webkitSpeechRecognition();  
      recognition.lang = "en-US";  
      recognition.continuous = false;  
      recognition.interimResults = false;  
      recognition.onresult = e => {  
        document.getElementById("user-input").value = e.results[0][0].transcript;  
        sendMessage();  
      };  
      recognition.onerror = e => alert("Speech error: " + e.error);  
      recognition.start();  
    }  
  
    function loginUser() {  
      const email = document.getElementById("login-email").value;  
      const password = document.getElementById("login-password").value;  
      auth.signInWithEmailAndPassword(email, password)  
        .then(() => {  
          loggedIn = true;  
          chatCount = 0;  
          document.getElementById("login-popup").classList.remove("show");  
        })  
        .catch(err => alert("Login error: " + err.message));  
    }  
  
    function googleSignIn() {  
      const provider = new firebase.auth.GoogleAuthProvider();  
      auth.signInWithPopup(provider)  
        .then(() => {  
          loggedIn = true;  
          chatCount = 0;  
          document.getElementById("login-popup").classList.remove("show");  
        })  
        .catch(err => alert("Google login error: " + err.message));  
    }  
  </script>  
</body>  
</html>
